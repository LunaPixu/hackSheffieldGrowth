@page "/"
@using Forestry.Components;
@using Automata;

<PageTitle>Home</PageTitle>

@code {
    // If valid cell was clicked, update it
    // Values are passed from the clicked cell to this method
    // col and row are used to identify the clicked cell
    private void ClickCell((int row, int col, int newVal) value)
    {
        Cells.Grid[value.row, value.col].Type = value.newVal;
    }

    // Initialise grid. This only happens on page load at fixed size atm. All sizes are supported (though really large sizes may not fit well).
    static int gridSize = 10;
    CellGrid Cells = new((gridSize, gridSize));
    static int pxGridSize = gridSize * 80;

    // When next button is clicked, step through cell automata
    private void NextStep() => Cells.Automata();
}
<div class="cell-grid" style="width: @(pxGridSize + "px")">
@for (int i = 0; i < Cells.Grid.GetLength(0); i++) {
    <div style="width: auto">
        @for (int j = 0; j < Cells.Grid.GetLength(1); j++) {
            (int row, int col) coords = (i, j);
            string bg;
            if ((i + j) % 2 == 0) {
                bg = "dark-cell";
            } else {
                bg = "light-cell";
            }
            <TreeCell age="@Cells.Grid[i,j].Type" bg="@bg" coords="@coords" Clicked=@ClickCell/>
        }
    </div>
}
</div>
<button class="important-button" @onclick="NextStep">Next Step</button>